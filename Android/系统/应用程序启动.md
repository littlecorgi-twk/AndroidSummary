# 应用程序启动过程

启动过程可以分成两部分：

- AMS发送启动应用程序进程请求
- Zygote收到请求并fork出新进程

## AMS发送启动应用程序进程请求

1. 获取用户 ID `uid` 和用户组 ID `gids` ，以及主线程类名一起传给 `ZygoteProcess.start()`方法
2. `ZygoteProcess`会讲传入的这些参数拼装成 `args` ArrayList，同时根据传入 `abi` 类型，和主 `ZygoteState` 以及 辅 `ZygoteState` 进行匹配，匹配上了就将 `args` 写入到 `ZygoteState` 中，用于和 Zygote 进程通信。

### ZygoteState

Zygote 启动是依赖于系统配置的 Zygote 启动脚本指定的。启动脚本一般有 4 种：

- `init.zygote32.rc`
- `init.zygote32_64.rc`
- `init.zygote64.rc`
- `init.zygote64_32.rc`

 如果是 32 则代表支持纯 32 位程序，64 也只支持 64 位程序。如果是 32_64，此时会启动两个 Zygote 进程，一个 32 位的，为主进程，一个 64 位的，为辅进程。

## Zygote 收到请求并创建新进程

